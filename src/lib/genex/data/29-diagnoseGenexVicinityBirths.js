import fs from 'fs'
import { birthsByVicinity, birthsByVicinitySummary } from './../genex/index.js'
// Data
import {_vicinityEventsBevins} from './diagnostics/genex/vicinities/_vicinityEventsBevins.js'
import {_vicinityEventsBjr} from './diagnostics/genex/vicinities/_vicinityEventsBjr.js'
import {_vicinityEventsCdb} from './diagnostics/genex/vicinities/_vicinityEventsCdb.js'

function fix(str) { return JSON.stringify(str) }

function writeFile(label, vicinityBirths, vicinitySummary) {
    const inputFile = `./diagnostics/genex/vicinities/_vicinityEvents${label}.js`
    const outputFile = `./diagnostics/genex/vicinities/_vicinityBirths${label}.js`
    let js = `// auto-generated by ${progName} on ${new Date().toLocaleString()}\n`
        + `// Contains ${vicinityBirths.length} Vicinities with births from:\n`
        + `export const _vicinityBirths${label} = [\n`
    // Loop for each Vicinity
    for(let i=0; i<vicinityBirths.length; i++) {
        const [location, label, births] = vicinityBirths[i]
        const [n, genMin, genMax, birthMin, birthMax] = vicinitySummary[i]
        js += `    [${fix(location)}, ${fix(label)}, ${n}, `
            + `${genMin}, ${genMax}, ${birthMin}, ${birthMax}, [\n`
        // Loop for each Person
        for(let j=0; j<births.length; j++) {
            const [nameKey, birthYear, gen] = births[j]
            js += `        [${fix(nameKey)}, ${birthYear}, ${gen}],\n`
        }
        js += '    ]],\n'
    }
    js += ']\n'
    fs.writeFile(outputFile, js, function (err) { if (err) throw err })
    console.log(`    2 - wrote ${vicinityBirths.length} Vicinities with births from ${inputFile} into '${outputFile}'.`)
}

function vicinityBirths(label, vicinityEvents) {
    const vicinityBirths = birthsByVicinity(vicinityEvents)
    const summary = birthsByVicinitySummary(vicinityBirths)
    writeFile(label, vicinityBirths, summary)
}

const time1 = new Date()
const progName = (process.argv[1]).split('\\').pop()
vicinityBirths('Bevins', _vicinityEventsBevins)
vicinityBirths('Cdb', _vicinityEventsCdb)
vicinityBirths('Bjr', _vicinityEventsBjr)
console.log(`    Successfully completed in ${new Date()-time1} msec`)
