import fs from 'fs'
import { selectLines } from '../gedcom/selectLines.js'
import { _gedcomContextFilter } from './customized/_gedcomContextFilter.js'
import { _gedcomRecordsAll } from './generated/gedcom/_gedcomRecordsAll.js'

const time1 = new Date()
const progName = (process.argv[1]).split('\\').pop()
const inputFile = './generated/gedcom/_gedcomRecordsAll.js'
const varName = '_gedcomRecordsFiltered'
const outputFile = `./generated/gedcom/${varName}.js`
const records = selectLines(_gedcomRecordsAll, new Set(_gedcomContextFilter))

const head = [
    `// auto-generated by ${progName} on ${new Date().toLocaleString()}`,
    `// from '${inputFile}'`,
    `export const ${varName} = [`
]
let js = head.join('\n') + '\n'
for(let i=0; i<records.length; i++) js += JSON.stringify(records[i]) + ',\n'
js += ']\n'
fs.writeFile(outputFile, js, function (err) { if (err) throw err })

const time2 = new Date()
console.log(`${progName} (${time2-time1} msec)`)
console.log(`    Filtered ${_gedcomRecordsAll.length} records from '${inputFile}' into ${records.length} of '${outputFile}'.`)
