import fs from 'fs'
import { contextCounts } from '../gedcom/contextCounts.js'
import {_gedcomRecordsFiltered} from './generated/gedcom/_gedcomRecordsFiltered.js'

const time1 = new Date()
const progName = (process.argv[1]).split('\\').pop()
const inputFile = './generated/gedcom/_gedcomRecordsFiltered.js'
const varName = '_gedcomRecordsFilteredContexts'
const outputFile = `./diagnostics/gedcom/${varName}.js`
const contexts = contextCounts(_gedcomRecordsFiltered)

const head = [
    `// auto-generated by ${progName} on ${new Date().toLocaleString()}`,
    `// from FILTERED GEDCOM JSON records file '${inputFile}'`,
    `// Each element is [<GEDCOM context>, <count>]`,
    `export const ${varName} = [`
]
let js = head.join('\n') + '\n'
for(let i=0; i<contexts.length; i++) {
    const [context, count] = contexts[i]
    js += `    ["${context}", ${count}],\n`
}
js += ']\n'
fs.writeFile(outputFile, js, function (err) { if (err) throw err })

const time2 = new Date()
console.log( `${progName} (${time2-time1} msec)`)
console.log(`    Wrote ${contexts.length} unique GEDCOM record contexts from '${inputFile}' into '${outputFile}'.`)
