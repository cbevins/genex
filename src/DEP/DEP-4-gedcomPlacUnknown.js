import fs from 'fs'
import {_gedcom} from './lib/genex/data/tmp/GedcomJson.js'
import { missingPlaces } from './lib/genex/gedcom/missingPlaces.js'
import { GedcomPlaceKeys } from './lib/genex/data/saved/GedcomPlaceKeys.js'

const time1 = new Date()
const progName = (process.argv[1]).split('\\').pop()
const inputFile = './lib/genex/data/tmp/GedcomJson.js'
const outputFile = './lib/genex/data/output/gedcomMissingPlaces.js'
const keyFile = '/data/saved/GedcomPlaceKeys.js'

const missing = missingPlaces(_gedcom, GedcomPlaceKeys)

// Convert array to JSON string
let js = `// auto-generated by ${progName}\n`
js += `// from GEDCOM file '${inputFile}'\n`
js += `// on ${new Date().toLocaleString()}\n`
js += `// Each element is [<GEDCOM PLAC content>, <count>]\n`
js += `export const _gedcomMissingPlaces = [\n`
for(let i=0; i<missing.length; i++) {
    const [plac, count] = missing[i]
    js += `    ["${plac}", ${count}],\n`
}
js += ']\n'

// Write the JSON to a file for later use
fs.writeFile(outputFile, js, function (err) { if (err) throw err })

const time2 = new Date()
console.log( `${progName} ${inputFile} ${outputFile} (${time2-time1} msec)`)
console.log(`    There are ${missing.length} GEDCOM PLAC records not registered in ${keyFile}.`)
