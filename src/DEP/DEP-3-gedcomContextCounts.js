import fs from 'fs'
import { contextCounts } from './lib/genex/gedcom/contextCounts.js'
import {_gedcom} from './lib/genex/data/tmp/GedcomJson.js'

const time1 = new Date()
const inputFile = './lib/genex/data/tmp/GedcomJson.js'
const outputFile = './lib/genex/data/output/gedcomContextCounts.js'
const progName = (process.argv[1]).split('\\').pop()

const contexts = contextCounts(_gedcom)

// Convert array to JSON string
let js = `// auto-generated by ${progName}\n`
js += `// from GEDCOM file '${inputFile}'\n`
js += `// on ${new Date().toLocaleString()}\n`
js += `// Each element is [<GEDCOM context>, <count>]\n`
js += `export const _gedcomContextCounts = [\n`
for(let i=0; i<contexts.length; i++) {
    const [context, count] = contexts[i]
    js += `    ["${context}", ${count}],\n`
}
js += ']\n'

// Write the JSON to a file for later use
fs.writeFile(outputFile, js, function (err) { if (err) throw err })

const time2 = new Date()
console.log( `${progName} ${inputFile} ${outputFile} (${time2-time1} msec)`)
console.log(`    There are ${contexts.length} unique GEDCOM record contexts.`)
